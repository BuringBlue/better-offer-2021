## Javaé›†åˆ

![æ¸…æ™°umlå›¾](https://camo.githubusercontent.com/5f1947d51a8b2f9589a004ebe1ff06ce25bf5ceb1f8ef7e2bf51b9d979492d94/68747470733a2f2f7777772e706461692e746563682f5f696d616765732f6a6176615f636f6c6c656374696f6e735f6f766572766965772e706e67)



![Javaé›†åˆ](/Users/wenzhuowang/Desktop/æ¡†å›¾/Javaé›†åˆ.png)



### 1. ArrayListå’ŒLinkedListçš„åŒºåˆ«

|          | ArrayList                                                    | LinkedList                                                   |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| æ•°æ®ç»“æ„ | åŸºäº**åŠ¨æ€æ•°ç»„**                                             | åŸºäº**é“¾è¡¨**                                                 |
| ç‰¹ç‚¹     | æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œæ·»åŠ å’Œåˆ é™¤æ…¢                                     | æŸ¥æ‰¾æ…¢ï¼Œæ·»åŠ å’Œåˆ é™¤å¿«                                         |
| é€‚ç”¨åœºæ™¯ | é¢‘ç¹è®¿é—®åˆ—è¡¨ä¸­çš„æŸä¸€ä¸ªå…ƒç´ ã€‚ <br />åªéœ€è¦åœ¨åˆ—è¡¨æœ«å°¾è¿›è¡Œæ·»åŠ å’Œåˆ é™¤å…ƒç´ æ“ä½œã€‚ | éœ€è¦é€šè¿‡å¾ªç¯è¿­ä»£æ¥è®¿é—®åˆ—è¡¨ä¸­çš„æŸäº›å…ƒç´ ã€‚<br />éœ€è¦é¢‘ç¹çš„åœ¨åˆ—è¡¨å¼€å¤´ã€ä¸­é—´ã€æœ«å°¾ç­‰ä½ç½®è¿›è¡Œæ·»åŠ å’Œåˆ é™¤å…ƒç´ æ“ä½œã€‚ |



```java
import java.util.LinkedList;
import java.util.ArrayList;
import java.util.Collections;

LinkedList<E> list1 = new LinkedList<E>(); // é“¾è¡¨  
ArrayList<E> list2 =new ArrayList<E>();  //æ•°ç»„
Collections.sort(list2); //æ’åº

```



| ArrayList                                                    | åŠŸèƒ½                                          | LinkedList                                  | åŠŸèƒ½                                                         |
| ------------------------------------------------------------ | --------------------------------------------- | ------------------------------------------- | ------------------------------------------------------------ |
| [add()](https://www.runoob.com/java/java-arraylist-add.html) | å°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®çš„ arraylist ä¸­           | boolean **add**(E e)                        | é“¾è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œè¿”å›æ˜¯å¦æˆåŠŸã€‚<br />è‹¥åœ¨æ»¡é˜Ÿåˆ—åŠ æ–°é¡¹ï¼Œåˆ™æŠ›å¼‚å¸¸ |
| [addAll()](https://www.runoob.com/java/java-arraylist-addall.html) | æ·»åŠ é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ åˆ° arraylist ä¸­           | void **add**(int index, E element)          | å‘æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ã€‚                                         |
| [clear()](https://www.runoob.com/java/java-arraylist-clear.html) | åˆ é™¤ arraylist ä¸­çš„æ‰€æœ‰å…ƒç´                    | boolean **addAll**(Collection c)            | å°†ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨åé¢ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ             |
| [clone()](https://www.runoob.com/java/java-arraylist-clone.html) | å¤åˆ¶ä¸€ä»½ arraylist                            | boolean **addAll**(int index, Collection c) | å°†ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨çš„æŒ‡å®šä½ç½®åé¢ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ   |
| [contains()](https://www.runoob.com/java/java-arraylist-contains.html) | åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨ arraylist                      | void **addFirst**(E e)                      | å…ƒç´ æ·»åŠ åˆ°å¤´éƒ¨ã€‚                                             |
| [get()](https://www.runoob.com/java/java-arraylist-get.html) | é€šè¿‡ç´¢å¼•å€¼è·å– arraylist ä¸­çš„å…ƒç´              | void **addLast**(E e)                       | å…ƒç´ æ·»åŠ åˆ°å°¾éƒ¨ã€‚                                             |
| [indexOf()](https://www.runoob.com/java/java-arraylist-indexof.html) | è¿”å› arraylist ä¸­å…ƒç´ çš„ç´¢å¼•å€¼                 | boolean **offer**(E e)                      | å‘é“¾è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ<br />è‹¥åœ¨æ»¡é˜Ÿåˆ—åŠ æ–°é¡¹ï¼Œåˆ™è¿”false |
| [removeAll()](https://www.runoob.com/java/java-arraylist-removeall.html) | åˆ é™¤å­˜åœ¨äºæŒ‡å®šé›†åˆä¸­çš„ arraylist é‡Œçš„æ‰€æœ‰å…ƒç´  | boolean **offerFirst**(E e)                 | å¤´éƒ¨æ’å…¥å…ƒç´ ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ                                   |
| [remove()](https://www.runoob.com/java/java-arraylist-remove.html) | åˆ é™¤ arraylist é‡Œçš„å•ä¸ªå…ƒç´                    | boolean **offerLast**(E e)                  | å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ                                   |
| [size()](https://www.runoob.com/java/java-arraylist-size.html) | è¿”å› arraylist é‡Œå…ƒç´ æ•°é‡                     | void **clear**()                            | æ¸…ç©ºé“¾è¡¨ã€‚                                                   |
| [isEmpty()](https://www.runoob.com/java/java-arraylist-isempty.html) | åˆ¤æ–­ arraylist æ˜¯å¦ä¸ºç©º                       | E **removeFirst**()                         | åˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚                                       |
| [subList()](https://www.runoob.com/java/java-arraylist-sublist.html) | æˆªå–éƒ¨åˆ† arraylist çš„å…ƒç´                      | E **removeLast**()                          | åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ã€‚                                     |
| [set()](https://www.runoob.com/java/java-arraylist-set.html) | æ›¿æ¢ arraylist ä¸­æŒ‡å®šç´¢å¼•çš„å…ƒç´                | boolean **remove**(Object o)                | åˆ é™¤æŸä¸€å…ƒç´ ï¼Œè¿”å›æ˜¯å¦æˆåŠŸ                                   |
| [sort()](https://www.runoob.com/java/java-arraylist-sort.html) | å¯¹ arraylist å…ƒç´ è¿›è¡Œæ’åº                     | E **remove**(int index)                     | åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚                                         |
| [toArray()](https://www.runoob.com/java/java-arraylist-toarray.html) | å°† arraylist è½¬æ¢ä¸ºæ•°ç»„                       | E **poll**()                                | åˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè·å–å¤±è´¥è¿”ç©º                           |
| [toString()](https://www.runoob.com/java/java-arraylist-tostring.html) | å°† arraylist è½¬æ¢ä¸ºå­—ç¬¦ä¸²                     | E **remove**()                              | åˆ é™¤å¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè·å–å¤±è´¥æŠ›å¼‚å¸¸                         |
| [ensureCapacity()](https://www.runoob.com/java/java-arraylist-surecapacity.html) | è®¾ç½®æŒ‡å®šå®¹é‡å¤§å°çš„ arraylist                  | boolean **contains**(Object o)              | åˆ¤æ–­æ˜¯å¦å«æœ‰æŸä¸€å…ƒç´ ã€‚                                       |
| [lastIndexOf()](https://www.runoob.com/java/java-arraylist-lastindexof.html) | è¿”å›æŒ‡å®šå…ƒç´ åœ¨ arraylist ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½® | E **get**(int index)                        | è¿”å›æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚                                         |
| [retainAll()](https://www.runoob.com/java/java-arraylist-retainall.html) | ä¿ç•™ arraylist ä¸­åœ¨æŒ‡å®šé›†åˆä¸­ä¹Ÿå­˜åœ¨çš„é‚£äº›å…ƒç´  | E **getFirst**()                            | è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚                                             |
| [containsAll()](https://www.runoob.com/java/java-arraylist-containsall.html) | æŸ¥çœ‹ arraylist æ˜¯å¦åŒ…å«æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´    | E **getLast**()                             | è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ã€‚                                           |
| [trimToSize()](https://www.runoob.com/java/java-arraylist-trimtosize.html) | å°† arraylist ä¸­çš„å®¹é‡è°ƒæ•´ä¸ºæ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°   | int **indexOf**(Object o)                   | æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ä»å‰å¾€åç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚                       |
| [removeRange()](https://www.runoob.com/java/java-arraylist-removerange.html) | åˆ é™¤ arraylist ä¸­æŒ‡å®šç´¢å¼•ä¹‹é—´å­˜åœ¨çš„å…ƒç´        | int **lastIndexOf**(Object o)               | æŸ¥æ‰¾æŒ‡å®šå…ƒç´ æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ã€‚                             |
| [replaceAll()](https://www.runoob.com/java/java-arraylist-replaceall.html) | å°†ç»™å®šçš„æ“ä½œå†…å®¹æ›¿æ¢æ‰æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´         | E **peek**()                                | è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚<br />listä¸ºç©ºæ—¶ï¼Œè¿”å›null                   |
| [removeIf()](https://www.runoob.com/java/java-arraylist-removeif.html) | åˆ é™¤æ‰€æœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„ arraylist å…ƒç´          | E **element**()                             | è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚<br />listä¸ºç©ºæ—¶ï¼ŒæŠ›å¼‚å¸¸                     |
| [forEach()](https://www.runoob.com/java/java-arraylist-foreach.html) | éå† arraylist ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¹¶æ‰§è¡Œç‰¹å®šæ“ä½œ     | E **peekFirst**()                           | è¿”å›å¤´éƒ¨å…ƒç´ ã€‚                                               |



### 2. HashMapå’ŒHashTableçš„åŒºåˆ«

|                              | HashTable                                        | HashMap                                                      | ConcurrentHashMap                                            |
| ---------------------------- | ------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ç»§æ‰¿çš„çˆ¶ç±»ä¸åŒ               | ç»§æ‰¿è‡ªDictionaryç±»                               | HashMapç»§æ‰¿è‡ªAbstractMapç±»                                   |                                                              |
| åº•å±‚å®ç°ä¸åŒ                 | åº•å±‚æ˜¯**æ•°ç»„+é“¾è¡¨**                              | 1.7ç‰ˆæœ¬åº•å±‚æ˜¯ æ•°ç»„+é“¾è¡¨ï¼ˆé“¾å¼ï¼‰<br />1.8ç‰ˆæœ¬åº•å±‚æ˜¯ **æ•°ç»„+é“¾è¡¨orçº¢é»‘æ ‘** | 1.7ç‰ˆæœ¬åº•å±‚æ˜¯ æ•°ç»„+é“¾è¡¨<br />1.8ç‰ˆæœ¬åº•å±‚æ˜¯ **æ•°ç»„+é“¾è¡¨orçº¢é»‘æ ‘** |
| çº¿ç¨‹å®‰å…¨æ€§ä¸åŒ               | **çº¿ç¨‹å®‰å…¨**<br />æ¯ä¸ªæ–¹æ³•å‰åŠ äº†**synchronized** | **éçº¿ç¨‹å®‰å…¨**<br />åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä½¿ç”¨HashMapå¿…é¡»è¦è‡ªå·±å¢åŠ åŒæ­¥å¤„ç† | **çº¿ç¨‹å®‰å…¨**<br />1.7æ˜¯åˆ†æ®µé”<br />1.8æ˜¯å»æ‰åˆ†æ®µé”æ”¹æˆcas+synchronized |
| **keyå’Œvalueæ˜¯å¦å…è®¸nullå€¼** | keyå’Œvalueéƒ½ä¸å…è®¸å‡ºç°nullå€¼                     | nullå¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼›å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸ºnull |                                                              |
| **hashå€¼ä¸åŒ**               | ç›´æ¥ä½¿ç”¨å¯¹è±¡çš„hashCode                           | é‡æ–°è®¡ç®—hashå€¼ï¼šhashcode çš„é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–æ“ä½œ    |                                                              |
|                              | containsï¼ˆ=ï¼‰containsValueï¼ŒcontainsKey          | å»æ‰contains<br />containsValueå’ŒcontainsKey                 |                                                              |



### 3. ArrayListæœ‰å“ªäº›å¹¶å‘é—®é¢˜

#### å‘ç”Ÿä½ç½®

å…¶å®å°±æ˜¯**size++** è¿™ä¸€æ­¥çš„é—®é¢˜

#### å¯èƒ½å¼•å‘çš„é—®é¢˜

1. **è¶Šç•Œ**ï¼šä¸¤ä¸ªçº¿ç¨‹**ä¸´ç•Œå€¼**å»**æ‰©å®¹**éƒ½æ»¡è¶³ï¼Œäºæ˜¯ä¸€ä¸ªçº¿ç¨‹size++å¯¼è‡´çš„ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å°±æº¢å‡ºäº†ï¼Œ
2. **null**ï¼šelement[size] = e,ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜æ²¡æ¥å¾—åŠsize++ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹å°±åœ¨åŸå…ˆçš„ç´¢å¼•ä¸ŠæŠŠå€¼ç»™è¦†ç›–äº†ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€ä¸ªç´¢å¼•ä¸ºnullã€‚



### 4. HashMap

1. è°ˆè°ˆä½ ç†è§£çš„ HashMapï¼Œè®²è®²å…¶ä¸­çš„ get put è¿‡ç¨‹ã€‚
2. 1.8 åšäº†ä»€ä¹ˆä¼˜åŒ–ï¼Ÿ
3. æ˜¯çº¿ç¨‹å®‰å…¨çš„å˜›ï¼Ÿ
4. ä¸å®‰å…¨ä¼šå¯¼è‡´å“ªäº›é—®é¢˜ï¼Ÿ
5. å¦‚ä½•è§£å†³ï¼Ÿæœ‰æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Ÿ
6. ConcurrentHashMap æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ 1.7ã€1.8 å®ç°æœ‰ä½•ä¸åŒï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ

![img](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2016/e4a19398.png)



#### 4.1 å‚æ•°

```java
static final int MAXIMUM_CAPACITY = 1 << 30;//åˆå§‹åŒ–æ¡¶å¤§å°ï¼Œå› ä¸ºåº•å±‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥è¿™æ˜¯æ•°ç»„é»˜è®¤çš„å¤§å°ã€‚

//æ¡¶æœ€å¤§å€¼
 
static final float DEFAULT_LOAD_FACTOR = 0.75f;//å¡«å……æ¯”(è´Ÿè½½å› å­)
 
//å½“addä¸€ä¸ªå…ƒç´ åˆ°æŸä¸ªä½æ¡¶ï¼Œå…¶é“¾è¡¨é•¿åº¦è¾¾åˆ°8æ—¶å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘
static final int TREEIFY_THRESHOLD = 8;
//é€€åŒ–é“¾è¡¨çš„é˜ˆå€¼æ˜¯6
static final int UNTREEIFY_THRESHOLD = 6;
 
static final int MIN_TREEIFY_CAPACITY = 64;
 
transient Node<k,v>[] table;//å­˜å‚¨å…ƒç´ çš„æ•°ç»„
 
transient Set<map.entry<k,v>> entrySet;
 
transient int size;//å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°
 
transient int modCount;//è¢«ä¿®æ”¹çš„æ¬¡æ•°fast-failæœºåˆ¶
 
int threshold;//ä¸´ç•Œå€¼ å½“å®é™…å¤§å°(å®¹é‡*å¡«å……æ¯”)è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹
```



1. **ä¸ºä»€ä¹ˆå®¹é‡è¦æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Ÿ**

å› ä¸ºè·å– key åœ¨æ•°ç»„ä¸­å¯¹åº”çš„ä¸‹æ ‡æ˜¯é€šè¿‡ key çš„å“ˆå¸Œå€¼ä¸æ•°ç»„é•¿åº¦ -1 è¿›è¡Œä¸è¿ç®—ï¼Œå¦‚ï¼štab[i = (n - 1) & hash]

n ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œè¿™æ · n-1 åä¹‹å‰ä¸º 1 çš„ä½åé¢å…¨æ˜¯ 1ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ (n-1) & hash åç›¸åº”çš„ä½æ•°æ—¢å¯èƒ½æ˜¯ 0 åˆå¯èƒ½æ˜¯ 1ï¼Œè¿™å–å†³äº hash çš„å€¼ï¼Œè¿™æ ·èƒ½ä¿è¯æ•£åˆ—çš„å‡åŒ€ï¼ŒåŒæ—¶ä¸è¿ç®—æ•ˆç‡é«˜ã€‚å¦‚æœ n ä¸æ˜¯ 2 çš„æ•´æ•°æ¬¡å¹‚ï¼Œä¼šé€ æˆæ›´å¤šçš„ hash å†²çªã€‚



2. **ä¸ºä»€ä¹ˆ<u>çº¢é»‘æ ‘çš„é˜ˆå€¼</u>æ˜¯8ï¼Ÿ**

åœ¨ hash å‡½æ•°è®¾è®¡åˆç†çš„æƒ…å†µä¸‹ï¼Œå‘ç”Ÿ hash ç¢°æ’ 8 æ¬¡çš„å‡ ç‡ä¸ºç™¾ä¸‡åˆ†ä¹‹ 6ï¼Œæ¦‚ç‡è¯´è¯ã€‚(æ³Šæ¾åˆ†å¸ƒ)



3. **ä¸ºä»€ä¹ˆ<u>é€€åŒ–é“¾è¡¨çš„é˜ˆå€¼</u>æ˜¯6ï¼Ÿ**

6æ˜¯å› ä¸ºå¦‚æœ hash ç¢°æ’æ¬¡æ•°åœ¨ 8 é™„è¿‘å¾˜å¾Šï¼Œä¼šä¸€ç›´å‘ç”Ÿé“¾è¡¨å’Œçº¢é»‘æ ‘çš„è½¬åŒ–ï¼Œä¸ºäº†é¢„é˜²è¿™ç§æƒ…å†µçš„å‘ç”Ÿ



4. **ä¸ºä»€ä¹ˆ<u>è´Ÿè½½å› å­</u>æ˜¯0.75ï¼Ÿ**

   ä¸´ç•Œå€¼ï¼ˆthresholdï¼‰ = è´Ÿè½½å› å­ï¼ˆloadFactorï¼‰ \* å®¹é‡ï¼ˆcapacityï¼‰

è´Ÿè½½å› å­è¿‡ä½ï¼Œé¢‘ç¹æ‰©å®¹ï¼Œæ‰©å®¹ä¼šé‡æ–°å“ˆå¸Œï¼Œæ€§èƒ½ä¸‹é™ï¼›è´Ÿè½½å› å­è¿‡é«˜ï¼Œå®¹æ˜“æµªè´¹å®¹é‡.ï¼ˆç»éªŒ+æ¦‚ç‡ï¼‰



5. **hash ** æ‰°åŠ¨å‡½æ•°

hash å‡½æ•°æ˜¯å…ˆæ‹¿åˆ°é€šè¿‡ key çš„ hashcodeï¼Œ**æ˜¯ 32 ä½çš„ int å€¼**ï¼Œç„¶åè®© **hashcode çš„é«˜ 16 ä½å’Œä½ 16 ä½è¿›è¡Œå¼‚æˆ–æ“ä½œ**ã€‚

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

**ã€ç›®çš„ã€‘**å°½å¯èƒ½é™ä½ hash ç¢°æ’ï¼Œè®©æ•£åˆ—åˆ†å¸ƒåœ°æ›´åŠ å‡åŒ€ã€‚

ã€**whyä½è¿ç®—**ã€‘ç®—æ³•ä¸€å®šè¦å°½å¯èƒ½é«˜æ•ˆï¼Œå› ä¸ºè¿™æ˜¯é«˜é¢‘æ“ä½œ, å› æ­¤é‡‡ç”¨ä½è¿ç®—

![img](https://images2018.cnblogs.com/blog/1303695/201804/1303695-20180407220236171-1291169329.png)



#### 4.2 put

```java
hashmap.put(Object key, Object value);
```

![HashMap](/Users/wenzhuowang/Desktop/æ¡†å›¾/HashMap.png)



#### 4.3 get

```java
hashmap.get(Object key)
```

1. åˆ¤æ–­ï¼šæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºï¼Œè¿”å›null
2. ä¸ä¸ºç©ºï¼Œåˆ¤æ–­ç¬¬ä¸€ä¸ªä½ç½®æ˜¯å¦ä¸ºæŸ¥è¯¢keyï¼Œæ˜¯ï¼Œè¿”å›value
3. ä¸æ˜¯ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç»§ç»­åˆ¤æ–­æ˜¯å¦ä¸ºçº¢é»‘æ ‘ï¼Œæ˜¯ï¼ŒæŒ‰æ ‘æŸ¥æ‰¾
4. ä¸æ˜¯ï¼ŒæŒ‰é“¾è¡¨æŸ¥æ‰¾



#### 4.4 æ‰©å®¹

1.8 HashMapçš„æ‰©å®¹ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´çœç•¥äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”æ–°å¢çš„1ä½æ˜¯0è¿˜æ˜¯1æœºä¼šæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚å¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¸ä¼šå€’ç½®ã€‚

##### æ‰©å®¹å¼•å‘çš„å¹¶å‘é—®é¢˜

- HashMapæ‰©å®¹çš„æ—¶å€™ä¼šè°ƒç”¨resize()æ–¹æ³•ï¼Œå°±æ˜¯è¿™é‡Œçš„å¹¶å‘æ“ä½œå®¹æ˜“åœ¨ä¸€ä¸ªæ¡¶ä¸Šå½¢æˆç¯å½¢é“¾è¡¨

  è¿™æ ·å½“è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„keyæ—¶ï¼Œè®¡ç®—å‡ºçš„indexæ­£å¥½æ˜¯ç¯å½¢é“¾è¡¨çš„ä¸‹æ ‡å°±ä¼šå‡ºç°æ­»å¾ªç¯ã€‚

- **ä½†æ˜¯1.7çš„å¤´æ’æ³•é€ æˆçš„é—®é¢˜ï¼Œ1.8æ”¹å˜äº†æ’å…¥é¡ºåºï¼Œå°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¸ºäº†å†…å­˜å¯è§æ€§ç­‰å®‰å…¨æ€§ï¼Œè¿˜æ˜¯éœ€è¦ConCurrentHashMap**

- HashTable æ˜¯ç›´æ¥åœ¨æ“ä½œæ–¹æ³•ä¸ŠåŠ  synchronized å…³é”®å­—ï¼Œé”ä½æ•´ä¸ªæ•°ç»„ï¼Œç²’åº¦æ¯”è¾ƒå¤§

- Collections.synchronizedMap æ˜¯ä½¿ç”¨ Collections é›†åˆå·¥å…·çš„å†…éƒ¨ç±»ï¼Œé€šè¿‡ä¼ å…¥ Map å°è£…å‡ºä¸€ä¸ª SynchronizedMap å¯¹è±¡ï¼Œå†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡é”ï¼Œæ–¹æ³•å†…é€šè¿‡å¯¹è±¡é”å®ç°

- **ConcurrentHashMap ä½¿ç”¨åˆ†æ®µé”ï¼Œé™ä½äº†é”ç²’åº¦ï¼Œè®©å¹¶å‘åº¦å¤§å¤§æé«˜ã€‚**(jdk1.8 CAS+ synchronized)

  

### 5. æ•°ç»„/é“¾è¡¨/é˜Ÿåˆ—/...å¸¸ç”¨æ“ä½œ

#### é˜Ÿåˆ—

add         å¢åŠ ä¸€ä¸ªå…ƒç´¢                      å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªIIIegaISlabEepeplianå¼‚å¸¸
remove   ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´      å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸
element  è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´               å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªNoSuchElementExceptionå¼‚å¸¸
offer       æ·»åŠ ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›true        å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¿”å›false
poll         ç§»é™¤å¹¶è¿”é—®é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´      å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null
peek       è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´               å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›null
put         æ·»åŠ ä¸€ä¸ªå…ƒç´                        å¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ™é˜»å¡
take        ç§»é™¤å¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´      å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™é˜»å¡



### 6. ConcurrentHashMap

#### 6.1 ç›®çš„

 JDK æ¨å‡ºäº†ä¸“é¡¹ä¸“ç”¨çš„ ConcurrentHashMap ï¼Œè¯¥ç±»ä½äº `java.util.concurrent` åŒ…ä¸‹ï¼Œä¸“é—¨ç”¨äºè§£å†³å¹¶å‘é—®é¢˜ã€‚



#### 6.2 1.7ç‰ˆæœ¬

##### 6.2.1 getçš„æµç¨‹

**é¦–å…ˆéœ€è¦å°†keyé€šè¿‡hashä¹‹åå®šä½åˆ°å…·ä½“çš„segmentï¼Œç„¶åå†çŸ¥é“hashentryçš„indexï¼Œæœ€åä¸€æ¬¡å¾ªç¯éå†è¯¥indexä¸‹çš„å…ƒç´ .**

ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œ**å› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”**ã€‚

```java
// ç¡®å®šsegmentï¼š
(h >>> segmentShift) & segmentMaskã€‚é»˜è®¤ä½¿ç”¨hçš„å‰4ä½ï¼ŒsegmentMaskä¸º15
  
// ç¡®å®šindexï¼š
(tab.length - 1) & h  hashentryçš„é•¿åº¦å‡1ï¼Œç”¨ä¹‹å‰ç¡®å®šäº†segmentçš„æ–°hè®¡ç®—
  
// å¾ªç¯ï¼š
for (HashEntry<K,V> e = (HashEntry<K,V>) UNSAFE.getObjectVolatile(tab, ((long)(((tab.length - 1) & h)) << TSHIFT) + TBASE);e != null; e = e.next)
  
// æ¯”è¾ƒï¼š
if ((k = e.key) == key || (e.hash == h && key.equals(k)))
                 return e.value;
```

##### 6.2.2 put çš„æµç¨‹

1. å°†å½“å‰çš„Segmentä¸­çš„tableé€šè¿‡keyçš„hashcodeå®šä½åˆ°HashEntry
2. éå†è¯¥HashEntryï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™åˆ¤æ–­ä¼ å…¥çš„keyå’Œå½“å‰éå†çš„keyæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¦†ç›–æ—§çš„value
3. ä¸ä¸ºç©ºåˆ™éœ€è¦æ–°å»ºä¸€ä¸ªHashEntryå¹¶åŠ å…¥åˆ°Segmentä¸­ï¼ŒåŒæ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
4. æœ€åä¼šè§£é™¤åœ¨1ä¸­æ‰€è·å–å½“å‰Segmentçš„é”ã€‚

âš ï¸**æ³¨æ„**ï¼š

- è™½ç„¶HashEntryä¸­çš„valueæ˜¯ç”¨volatileå…³é”®å­—ä¿®é¥°çš„ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¹¶å‘çš„åŸå­æ€§ï¼Œæ‰€ä»¥putæ“ä½œä»ç„¶éœ€è¦åŠ é”å¤„ç†ã€‚
- é¦–å…ˆç¬¬ä¸€æ­¥çš„æ—¶å€™ä¼šå°è¯•è·å–é”ï¼Œå¦‚æœè·å–å¤±è´¥è‚¯å®šå°±æ˜¯å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰ï¼Œåˆ™åˆ©ç”¨`scanAndLockForPut()`**è‡ªæ—‹è·å–é”**ï¼š
  - å°è¯•è·å–è‡ªæ—‹é”
  - å¦‚æœ**é‡è¯•çš„æ¬¡æ•°**è¾¾åˆ°äº†`MAX_SCAN_RETRIES` åˆ™æ”¹ä¸º**é˜»å¡é”**è·å–ï¼Œä¿è¯èƒ½è·å–æˆåŠŸã€‚

##### 6.2.3 size

ç¬¬ä¸€ç§æ–¹æ¡ˆï¼š**ä½¿ç”¨ä¸åŠ é”**çš„æ¨¡å¼**å»å°è¯•å¤šæ¬¡è®¡ç®— ConcurrentHashMap çš„ sizeï¼Œæœ€å¤š**ä¸‰æ¬¡**ï¼Œæ¯”è¾ƒå‰åä¸¤æ¬¡è®¡ç®—çš„ç»“æœï¼Œç»“æœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼Œè®¡ç®—çš„ç»“æœæ˜¯å‡†ç¡®çš„ã€‚ **

ç¬¬äºŒç§æ–¹æ¡ˆï¼š**å¦‚æœç¬¬ä¸€ç§æ–¹æ¡ˆä¸ç¬¦åˆ**ï¼Œä»–å°±ä¼š**ç»™æ¯ä¸ª Segment åŠ ä¸Šé”**ï¼Œç„¶å**è®¡ç®—** ConcurrentHashMap çš„ size è¿”å›



#### 6.3 1.8ç‰ˆæœ¬ğŸŒŸ

1.7 æŸ¥è¯¢éå†é“¾è¡¨æ•ˆç‡å¤ªä½ï¼ˆç§ç§åŸå› ï¼‰ã€‚å…¶ä¸­æŠ›å¼ƒäº†åŸæœ‰çš„ Segment åˆ†æ®µé”ï¼Œè€Œé‡‡ç”¨äº† `CAS + synchronized` æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ï¼ˆä¼šæ‰¯1.6å¯¹synchronizedçš„ä¼˜åŒ–ï¼‰

##### 6.3.1 getçš„æµç¨‹ï¼ˆä¸1.7ç›¸åŒï¼‰

1. æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æ¥è¿”å›å€¼ã€‚

2. å¦‚æœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼è·å–å€¼ã€‚

3. å°±ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†è·å–å€¼ã€‚



##### 6.3.2 putçš„æµç¨‹

1. æ ¹æ®keyè®¡ç®—å‡ºhashcode

2. åˆ¤æ–­tableæ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–

3. æ ¹æ®keyçš„hashcodeå®šä½åˆ°HashEntryçš„first

3. ğŸ†•**å¦‚æœfirstä¸ºnull**ï¼Œè¯´æ˜tableä¸­è¿™ä¸ªä½ç½®ç¬¬ä¸€æ¬¡æ’å…¥å…ƒç´ ï¼Œåˆ©ç”¨Unsafe.compareAndSwapObjectæ–¹æ³•æ’å…¥NodeèŠ‚ç‚¹ã€‚

â€‹       ï¼ˆ1ï¼‰**å¦‚æœCASæˆåŠŸ**ï¼Œè¯´æ˜NodeèŠ‚ç‚¹å·²ç»æ’å…¥ï¼ŒéšåaddCount(1L, binCount)æ–¹æ³•ä¼šæ£€æŸ¥å½“å‰å®¹é‡æ˜¯å¦éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚

â€‹       ï¼ˆ2ï¼‰**å¦‚æœCASå¤±è´¥**ï¼Œè¯´æ˜æœ‰å…¶å®ƒçº¿ç¨‹æå‰æ’å…¥äº†èŠ‚ç‚¹ï¼Œè‡ªæ—‹é‡æ–°å°è¯•åœ¨è¿™ä¸ªä½ç½®æ’å…¥èŠ‚ç‚¹ã€‚

5. **å¦‚æœfirstçš„hashå€¼ä¸º-1**ï¼Œè¯´æ˜å½“å‰fæ˜¯ForwardingNodeèŠ‚ç‚¹ï¼Œæ„å‘³æœ‰å…¶å®ƒçº¿ç¨‹æ­£åœ¨æ‰©å®¹ï¼Œåˆ™ä¸€èµ·è¿›è¡Œæ‰©å®¹æ“ä½œã€‚

6. **å¦‚æœéƒ½ä¸æ»¡è¶³**ï¼Œåˆ™åˆ©ç”¨`synchronized`é”å†™å…¥æ•°æ®ğŸ†• ï¼ˆä¸¤ä¸ªğŸ†•ä¸­æ˜¯1.8ä¸1.7ä¸åŒçš„åœ°æ–¹ï¼‰

7. å¦‚æœé“¾è¡¨é•¿åº¦è¾¾åˆ°é˜ˆå€¼8æ—¶å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘



##### 6.3.3 size

ConcurrentHashMap æä¾›äº† baseCountã€counterCells ä¸¤ä¸ªè¾…åŠ©å˜é‡å’Œä¸€ä¸ª CounterCell è¾…åŠ©å†…éƒ¨ç±»ã€‚sumCount() å°±æ˜¯è¿­ä»£ counterCells æ¥ç»Ÿè®¡ sum çš„è¿‡ç¨‹ã€‚ put æ“ä½œæ—¶ï¼Œè‚¯å®šä¼šå½±å“ size()ï¼Œåœ¨ put() æ–¹æ³•æœ€åä¼šè°ƒç”¨ **addCount()** æ–¹æ³•ã€‚

åœ¨**addCount()**æ–¹æ³•ä¸­ï¼š

- å¦‚æœ counterCells == null, åˆ™å¯¹ baseCount åš CAS è‡ªå¢æ“ä½œã€‚

- å¦‚æœå¹¶å‘å¯¼è‡´ baseCount CAS å¤±è´¥äº†ä½¿ç”¨ counterCellsã€‚

- å¦‚æœcounterCells CAS å¤±è´¥äº†ï¼Œåœ¨ fullAddCount æ–¹æ³•ä¸­ï¼Œä¼šç»§ç»­æ­»å¾ªç¯æ“ä½œï¼Œç›´åˆ°æˆåŠŸã€‚

- CounterCellä½¿ç”¨äº† @sun.misc.Contended æ ‡è®°çš„ç±»

  

#### 6.4 é”

##### 6.4.1**è‡ªæ—‹é”**

ç‰¹æ€§ï¼šå½“çº¿ç¨‹å°è¯•è·å–é”å¤±è´¥æ—¶ï¼ˆé”å·²ç»è¢«å…¶å®ƒçº¿ç¨‹å ç”¨äº†ï¼‰ï¼Œå®ƒä¸ä¼šå°†çº¿ç¨‹åˆ‡æ¢ä¸ºæ²‰ç¡çŠ¶æ€ï¼Œè€Œæ˜¯å¼€å¯æ— é™å¾ªç¯ï¼Œä¸æ–­åœ°è½®è¯¢é”çš„çŠ¶æ€ï¼Œå½“é”çŠ¶æ€è¢«æ›´æ”¹æ—¶ï¼Œè·å–åˆ°é”å¹¶è¿›å…¥ä¸´ç•ŒåŒº.

è‡ªæ—‹é”æœ¬èº«å¹¶æ²¡æœ‰å…³æ³¨å…¬å¹³æ€§ã€å¯é‡å…¥æ€§ç­‰ç‰¹æ€§ï¼Œå¦å¤–ï¼Œç”±äºè‡ªæ—‹é”çš„å®ç°éœ€è¦ä¸æ–­è½®è¯¢é”çš„çŠ¶æ€ï¼Œå› æ­¤éœ€è¦å ç”¨CPUï¼Œ**é€‚ç”¨äºä¸´ç•ŒåŒºæ—¶é—´å¾ˆçŸ­çš„åœºæ™¯.** è‡ªæ—‹é”åˆå¯è¿›ä¸€æ­¥ç»†åˆ†ä¸º**æ’é˜Ÿè‡ªæ—‹é”(TicketLock)ã€MCSé”ä»¥åŠCLHé”**ï¼Œ å…¶ä¸­æ’é˜Ÿè‡ªæ—‹é”è§£å†³çš„æ˜¯å…¬å¹³æ€§çš„é—®é¢˜



##### 6.4.2**é˜»å¡é”**

ç‰¹æ€§ï¼šå½“çº¿ç¨‹å°è¯•è·å–é”å¤±è´¥æ—¶ï¼Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶ä¿¡å·åè¢«å”¤é†’.(çº¿ç¨‹çš„çŠ¶æ€åŒ…æ‹¬æ–°å»ºã€å°±ç»ªã€è¿è¡Œã€é˜»å¡åŠæ­»äº¡ï¼‰åœ¨JAVAä¸­ï¼Œèƒ½å¤Ÿå”¤é†’é˜»å¡çº¿ç¨‹çš„æ“ä½œåŒ…æ‹¬Object.notify, Object.notifyAll, Condition.signal, LockSupport.unpark(JUCä¸­å¼•å…¥ï¼‰

ä¼˜ç‚¹ï¼šåœ¨çº¿ç¨‹è·å–é”å¤±è´¥åï¼Œä¸ä¼šä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼ˆå ç”¨CPUï¼‰ï¼Œ å› æ­¤**åœ¨ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹**ï¼Œ é˜»å¡é”çš„æ€§èƒ½å°†æ˜æ˜¾ä¼˜äºè‡ªæ—‹é”



##### 6.4.3 äº’æ–¥é”

**ç›¸åŒ**

1. éƒ½æ˜¯ç”¨æ¥åè°ƒå¤šçº¿ç¨‹å¯¹å…±äº«å¯¹è±¡ã€å˜é‡çš„è®¿é—®

2. éƒ½æ˜¯å¯é‡å…¥é”ï¼ŒåŒä¸€çº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å¾—åŒä¸€ä¸ªé”

3. éƒ½ä¿è¯äº†å¯è§æ€§å’Œäº’æ–¥æ€§

| åŒºåˆ«                 | ReentrantLock                               | Synchronized                       |
| -------------------- | ------------------------------------------- | ---------------------------------- |
| **è·å¾—ã€é‡Šæ”¾é”æƒ…å½¢** | æ˜¾å¼è·å¾—ã€é‡Šæ”¾é”                            | éšå¼è·å¾—ã€é‡Šæ”¾é”                   |
| **é”çš„çº§åˆ«**         | `API`å±‚é¢çš„é”                               | `JVM`å±‚é¢é‡é‡çº§é”                  |
| **é”çš„ç±»å‹**         | å¯é‡å…¥ã€å…¬å¹³\éå…¬å¹³ã€å¯å“åº”ä¸­æ–­ã€å¼‚æ­¥é”     | å¯é‡å…¥ã€éå…¬å¹³ã€ä¸å¯ä¸­æ–­ï¼Œå¼ºé˜»å¡é” |
| **é”çŠ¶æ€**           | å¯åˆ¤æ–­ï¼Œå¯å“åº”ä¸­æ–­                          | ä¸å¯åˆ¤æ–­ï¼Œä¸å¯å“åº”ä¸­æ–­             |
| **å”¤é†’æ¡ä»¶**         | conditionç»‘å®šå¤šä¸ªæ¡ä»¶                       | notifyã€notifyall                  |
| **å‘ç”Ÿå¼‚å¸¸æ—¶**       | å¿…é¡»åœ¨finallyæ˜¾å¼é‡Šæ”¾é”ï¼Œå¦åˆ™ï¼Œä¸€ç›´é”ä½èµ„æº | ä¸»åŠ¨é‡Šæ”¾é”                         |
| é”å¯¹è±¡               | é€šè¿‡AQSå’ŒCASæ“ä½œï¼Œå®ç°çº¿ç¨‹é”çš„è·å–å’Œé‡Šæ”¾    |                                    |



##### 6.4.4 Lockè·å–é”çš„æ–¹å¼

å‡å¦‚çº¿ç¨‹`A`å’Œçº¿ç¨‹`B`ä½¿ç”¨åŒä¸€ä¸ªé”`LOCK`ï¼Œæ­¤æ—¶çº¿ç¨‹Aé¦–å…ˆè·å–åˆ°é”`LOCK.lock()`ï¼Œå¹¶ä¸”å§‹ç»ˆæŒæœ‰ä¸é‡Šæ”¾ã€‚å¦‚æœæ­¤æ—¶Bè¦å»è·å–é”ï¼Œæœ‰å››ç§æ–¹å¼ï¼š

| åºå· | è·å–é”çš„æ–¹å¼                        | ç‰¹æ€§                                                         |
| ---- | ----------------------------------- | ------------------------------------------------------------ |
| 1    | `LOCK.lock()`                       | **åœ¨ç­‰å¾…è·å–é”çš„è¿‡ç¨‹ä¸­ä¼‘çœ å¹¶ç¦æ­¢ä¸€åˆ‡çº¿ç¨‹è°ƒåº¦**<br />å³ä½¿è°ƒç”¨`B.interrupt()`ä¹Ÿä¸èƒ½ä¸­æ–­ï¼Œé™¤éçº¿ç¨‹Aè°ƒç”¨`LOCK.unlock()`é‡Šæ”¾é”ã€‚ |
| 2    | `LOCK.lockInterruptibly()`          | **åœ¨ç­‰å¾…è·å–é”çš„è¿‡ç¨‹ä¸­å¯è¢«ä¸­æ–­**<br />å½“è°ƒç”¨`B.interrupt()`ä¼šè¢«ä¸­æ–­ç­‰å¾…ï¼Œå¹¶æŠ›å‡º`InterruptedException`å¼‚å¸¸ï¼Œå¦åˆ™ä¼šä¸`lock()`ä¸€æ ·å§‹ç»ˆå¤„äºç­‰å¾…ä¸­ï¼Œç›´åˆ°çº¿ç¨‹Aé‡Šæ”¾é”ã€‚ |
| 3    | `LOCK.tryLock()`                    | **ä¸ä¼šç­‰å¾…ï¼Œè·å–åˆ°é”å¹¶è¿”å›true**ï¼›<br />**è·å–ä¸åˆ°é”ç›´æ¥è¿”å›false**ï¼Œå»æ‰§è¡Œä¸‹é¢çš„é€»è¾‘ã€‚ |
| 4    | `LOCK.tryLock(n, TimeUnit.SECONDS)` | **åœ¨æŒ‡å®šæ—¶é—´å†…ç­‰å¾…è·å–é”ï¼›è¿‡ç¨‹ä¸­å¯è¢«ä¸­æ–­**<br />è¯¥å¤„ä¼šåœ¨nç§’æ—¶é—´å†…å¤„äºç­‰å¾…ä¸­ï¼Œä½†å½“è°ƒç”¨`B.interrupt()`ä¼šè¢«ä¸­æ–­ç­‰å¾…ï¼Œå¹¶æŠ›å‡º`InterruptedException`ã€‚<br />nç§’æ—¶é—´å†…å¦‚æœçº¿ç¨‹Aé‡Šæ”¾é”ï¼Œä¼šè·å–åˆ°é”å¹¶è¿”å›trueï¼Œå¦åˆ™10ç§’è¿‡åä¼šè·å–ä¸åˆ°é”å¹¶è¿”å›falseï¼Œå»æ‰§è¡Œä¸‹é¢çš„é€»è¾‘ã€‚ |



#### 6.5 åŒºåˆ«HashMap & ConcurrentHashMap 1.7/1.8ç‰ˆæœ¬

|      | HashMap                              | ConcurrentHashMap 1.7                                        | ConcurrentHashMap 1.8                                        |
| ---- | ------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| åŒºåˆ« | ä¸ç®¡æ˜¯putè¿˜æ˜¯getæ“ä½œéƒ½éœ€è¦åšåŒæ­¥å¤„ç† | ã€ä¸HashMapæ¯”ã€‘<br />1. æ ¸å¿ƒæ•°æ®å¦‚ value ï¼Œé“¾è¡¨éƒ½æ˜¯ volatile ä¿®é¥°çš„ï¼Œä¿è¯äº†è·å–æ—¶çš„å¯è§æ€§<br />2. é‡‡ç”¨Segmentåˆ†æ®µé”ä¿è¯å¹¶å‘å®‰å…¨<br />å…¶ä¸­ Segment ç»§æ‰¿äº `ReentrantLock`<br />3. æ”¯æŒ CurrencyLevel (Segment æ•°ç»„æ•°é‡)çš„çº¿ç¨‹å¹¶å‘ã€‚ | ã€ä¸1.7æ¯”ã€‘<br />1. é‡‡ç”¨ `CAS + synchronized` æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§<br />2. å°† 1.7 ä¸­å­˜æ”¾æ•°æ®çš„ HashEntry æ”¹ä¸º Node(ï¼ˆä½†ä½œç”¨ç›¸åŒï¼‰ï¼›å…¶ä¸­valå’Œnextéƒ½ç”¨volatileä¿®é¥°ï¼š<br />`volatile V val;`<br />`volatile Node<K, V> next;` |
| å¥½å¤„ |                                      | è§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œå¹¶ä¸”èƒ½æ”¯æŒ N ä¸ª Segment çš„å¹¶å‘               | é‡‡ç”¨çº¢é»‘æ ‘ä¹‹åå¯ä»¥ä¿è¯æŸ¥è¯¢æ•ˆç‡                               |
| ç¼ºç‚¹ |                                      | æŸ¥è¯¢éå†é“¾è¡¨æ•ˆç‡å¤ªä½                                         |                                                              |



### 7. TreeSet & TreeMap

å®é™…ä¸ŠTreeSetè¿˜æ˜¯ç”¨TreeMapæ¥ä¿å­˜setå…ƒç´ ã€‚

TreeMapé‡‡ç”¨ä¸€ç§è¢«ç§°ä¸ºâ€œçº¢é»‘æ ‘â€çš„æ’åºäºŒå‰æ ‘æ¥ä¿å­˜Mapä¸­çš„çš„æ¯ä¸ªEntryâ€”â€”æ¯ä¸ªEntryéƒ½è¢«å½“åšçº¢é»‘æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹æ¥å¯¹å¾…ï¼›

TreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚



### 8. LinkedHashMap 

#### 8.1 ç›®çš„

åŸºäº `HashMap` ä½†å…·æœ‰é¡ºåºçš„åŒå‘é“¾è¡¨æ‰€æ„æˆï¼Œæ¥è§£å†³æœ‰æ’åºéœ€æ±‚çš„åœºæ™¯ã€‚

å› ä¸ºæ˜¯ç»§æ‰¿ä¸ `HashMap` çš„ï¼Œæ‰€ä»¥ä¸€äº› `HashMap` å­˜åœ¨çš„é—®é¢˜ `LinkedHashMap` ä¹Ÿä¼šå­˜åœ¨ï¼Œæ¯”å¦‚ä¸æ”¯æŒå¹¶å‘ç­‰ã€‚

#### 8.2 ä¸¤ç§æ’åºæ–¹å¼

- æ ¹æ®å†™å…¥é¡ºåºæ’åºã€‚
- æ ¹æ®è®¿é—®é¡ºåºæ’åºï¼šæ¯æ¬¡ `get` éƒ½ä¼šå°†è®¿é—®çš„å€¼ç§»åŠ¨åˆ°é“¾è¡¨æœ«å°¾ï¼Œè¿™æ ·é‡å¤æ“ä½œå°±èƒ½çš„åˆ°ä¸€ä¸ªæŒ‰ç…§è®¿é—®é¡ºåºæ’åºçš„é“¾è¡¨ã€‚

#### 8.3 æ‰‹æ’¸LRU

```java
// åŒå‘é“¾è¡¨+HashMapï¼ŒJavaä¸­çš„LinkedHashMapå°±å®ç°äº†è¯¥ç®—æ³•ã€‚
// get
public int get(int key) {
    if (map.containsKey(key)) {
        Node n = map.get(key); // è·å–å†…å­˜ä¸­å­˜åœ¨çš„å€¼ï¼Œæ¯”å¦‚A
        remove(n); //ä½¿ç”¨é“¾è¡¨çš„æ–¹æ³•ï¼Œç§»é™¤è¯¥èŠ‚ç‚¹
        setHead(n); //ä¾ç„¶ä½¿ç”¨é“¾è¡¨çš„æ–¹æ³•ï¼Œå°†è¯¥èŠ‚ç‚¹æ”¾å…¥å¤´éƒ¨
        return n.value;
    } 
    return -1;
}
// put
public void set(int key, int value) {
    if (map.containsKey(key)) {
        Node old = map.get(key);
        old.value = value;
        remove(old); // ç§»é™¤æ—§èŠ‚ç‚¹
        setHead(old); // æ”¾åˆ°é˜Ÿå¤´
    } else {
        Node created = new Node(key, value);
        if (map.size() >= capacity) {
            map.remove(end.key); // clearè¯¥key
            remove(end); //é“¾è¡¨ä¹Ÿæ˜¯ä¾æ¬¡
            setHead(created); // å°†createdæ”¾å…¥é˜Ÿå¤´
        } else {
            setHead(created); // å¦‚æœæ²¡æ»¡ï¼Œç›´æ¥æ”¾å…¥é˜Ÿå¤´
        }
        map.put(key,created);
    }
}

```



```java
//lc: 146. LRUç¼“å­˜æœºåˆ¶
class LRUCache {
    private int cap;
    private Map<Integer, Integer> map = new LinkedHashMap<>();
    public LRUCache(int capacity) {
        this.cap = capacity;
    }
    
    public int get(int key) {
        if (map.containsKey(key)) {
            int value = map.get(key);
            // æŸ¥ä¸€æ¬¡ï¼Œå°±å°†æŸ¥åˆ°åˆ°ä»åœ¨é˜Ÿå°¾
            map.remove(key);
            map.put(key,value);
            return value;
        }
        return -1;
    }
    
    public void put(int key, int value) {
        if (map.containsKey(key)) {
            map.remove(key);
        } else if (map.size() == cap) {
            // æ»¡äº†
            Iterator<Map.Entry<Integer, Integer>> iterator = map.entrySet().iterator();
            iterator.next();
            iterator.remove();
        }
        map.put(key, value);
    }
}

```

